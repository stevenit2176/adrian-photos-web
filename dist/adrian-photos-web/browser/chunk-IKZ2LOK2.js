import{a as m}from"./chunk-ZAQJCETW.js";import{L as l,O as d,Yb as p,a as c,f as n,i as s,r as u}from"./chunk-KLI6WXR5.js";var h="adrian-photos-cart",y=(()=>{class i{http;cartSubject=new s(this.getInitialCart());cart$=this.cartSubject.asObservable();constructor(t){this.http=t,this.loadCart()}getInitialCart(){return{items:[],subtotal:0,tax:0,taxRate:0,shipping:0,total:0,itemCount:0}}loadCart(){try{let t=localStorage.getItem(h);if(t){let e=JSON.parse(t);this.cartSubject.next(e)}}catch(t){console.error("Error loading cart from localStorage:",t),this.clearCart()}}saveCart(t){try{localStorage.setItem(h,JSON.stringify(t)),this.cartSubject.next(t)}catch(e){console.error("Error saving cart to localStorage:",e)}}addItem(t){let e=this.cartSubject.value,r=t.quantity||1,a=e.items.findIndex(o=>o.photoId===t.photoId&&o.productTypeId===t.productTypeId&&o.productSizeId===t.productSizeId);if(a>=0)e.items[a].quantity+=r,e.items[a].total=e.items[a].unitPrice*e.items[a].quantity;else{let o={id:this.generateItemId(),photoId:t.photoId,photoTitle:t.photoTitle,photoThumbnail:t.photoThumbnail,productTypeId:t.productTypeId,productTypeName:t.productTypeName,productSizeId:t.productSizeId,productSizeName:t.productSizeName,unitPrice:t.unitPrice,quantity:r,total:t.unitPrice*r};e.items.push(o)}this.recalculateCart(e)}updateQuantity(t,e){let r=this.cartSubject.value,a=r.items.find(o=>o.id===t);a&&(e<=0?this.removeItem(t):(a.quantity=e,a.total=a.unitPrice*e,this.recalculateCart(r)))}removeItem(t){let e=this.cartSubject.value;e.items=e.items.filter(r=>r.id!==t),this.recalculateCart(e)}clearCart(){let t=this.getInitialCart();this.saveCart(t)}getCart(){return this.cartSubject.value}getItemCount(){return this.cartSubject.value.itemCount}recalculateCart(t){t.subtotal=t.items.reduce((e,r)=>e+r.total,0),t.itemCount=t.items.reduce((e,r)=>e+r.quantity,0),t.tax=0,t.taxRate=0,t.shipping=0,t.total=t.subtotal,this.saveCart(t)}calculateTotals(t){let e=this.cartSubject.value;if(e.items.length===0)return new n(a=>{a.next({subtotal:0,tax:0,taxRate:0,shipping:0,total:0,itemCount:0}),a.complete()});let r={items:e.items.map(a=>({id:a.id,photoId:a.photoId,productTypeId:a.productTypeId,productSizeId:a.productSizeId,unitPrice:a.unitPrice,quantity:a.quantity})),shippingState:t};return this.http.post(`${m.apiUrl}/cart/calculate`,r).pipe(u(a=>{if(a.success){let o=c(c({},e),a.data);return this.saveCart(o),a.data}throw new Error("Failed to calculate cart totals")}))}generateItemId(){return`item-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}static \u0275fac=function(e){return new(e||i)(d(p))};static \u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();export{y as a};
