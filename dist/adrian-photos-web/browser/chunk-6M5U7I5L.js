import{a as he,b as Ce}from"./chunk-GSLRH7PO.js";import{b as fe,c as _e}from"./chunk-XV6M6TLB.js";import{a as L}from"./chunk-WM75V3NH.js";import{a as R}from"./chunk-ZAQJCETW.js";import{c as se,d as ge,e as ue}from"./chunk-K2GLQ4GK.js";import{a as me,b as de}from"./chunk-JEGDFQ3A.js";import{a as ce}from"./chunk-2DB5WL3Y.js";import{a as W,b as K,c as Q,h as X}from"./chunk-Z7H67QOJ.js";import{a as $,c as H,h as J}from"./chunk-PDGJ2ZUN.js";import"./chunk-RYSAEJIT.js";import"./chunk-4TETIUZD.js";import{d as Y,f as h,h as Z,i as ee,k as te,m as oe,n as ne,o as ie,p as re,r as ae,t as le,v as pe}from"./chunk-UYB4FCO3.js";import"./chunk-52PBV3KU.js";import{$c as j,Ia as c,Ja as n,Ka as o,La as P,Mb as z,Nb as U,R as d,S as g,Sa as b,Ua as _,Ub as V,Wa as M,Xb as O,Yb as T,Yc as N,_c as A,ad as G,bc as B,bd as q,d as F,eb as I,fa as S,fc as D,ga as p,gb as E,ib as a,kb as v,ma as C,qa as k,va as f}from"./chunk-KLI6WXR5.js";function Pe(r,u){r&1&&(n(0,"div",24)(1,"mat-icon",25),a(2,"cloud_upload"),o(),n(3,"h3"),a(4,"Drag & Drop Photo Here"),o(),n(5,"p"),a(6,"or click to browse"),o(),n(7,"p",26),a(8,"Supported: JPEG, PNG, WebP, GIF (Max 10MB)"),o()())}function Me(r,u){if(r&1){let e=b();n(0,"div",27),P(1,"img",28),n(2,"button",29),_("click",function(t){return d(e),M().removeFile(),g(t.stopPropagation())}),n(3,"mat-icon"),a(4,"close"),o()()()}if(r&2){let e=M();p(),c("src",e.imagePreview,S)}}function xe(r,u){r&1&&(n(0,"mat-error"),a(1," Title is required "),o())}function be(r,u){r&1&&(n(0,"mat-error"),a(1," Title must be at least 3 characters "),o())}function ve(r,u){r&1&&(n(0,"mat-error"),a(1," Description is required "),o())}function Oe(r,u){r&1&&(n(0,"mat-error"),a(1," Description must be at least 10 characters "),o())}function ye(r,u){if(r&1){let e=b();n(0,"mat-checkbox",30),_("change",function(t){let l=d(e).$implicit,s=M();return g(s.onCategoryChange(l.id,t.checked))}),a(1),o()}if(r&2){let e=u.$implicit,i=M();c("checked",i.isCategorySelected(e.id)),p(),v(" ",e.name," ")}}function we(r,u){r&1&&(n(0,"mat-error"),a(1," At least one category is required "),o())}function Fe(r,u){r&1&&(n(0,"mat-error"),a(1," Price must be 0 or greater "),o())}function Se(r,u){if(r&1&&(n(0,"div",31)(1,"p"),a(2),o(),P(3,"mat-progress-bar",32),o()),r&2){let e=M();p(2),v("Uploading... ",e.uploadProgress,"%"),p(),c("value",e.uploadProgress)}}var nt=(()=>{class r{fb;http;categoryService;snackBar;router;uploadForm;categories=[];selectedFile=null;imagePreview=null;isDragging=!1;isUploading=!1;uploadProgress=0;constructor(e,i,t,l,s){this.fb=e,this.http=i,this.categoryService=t,this.snackBar=l,this.router=s,this.uploadForm=this.fb.group({title:["",[h.required,h.minLength(3)]],description:["",[h.required,h.minLength(10)]],categoryIds:this.fb.array([],h.required),price:[0,[h.min(0)]]})}ngOnInit(){this.loadCategories()}loadCategories(){this.categoryService.getCategories().subscribe({next:e=>{this.categories=e},error:e=>{this.snackBar.open("Failed to load categories","Close",{duration:3e3}),console.error("Error loading categories:",e)}})}get categoryIdsArray(){return this.uploadForm.get("categoryIds")}onCategoryChange(e,i){if(i)this.categoryIdsArray.push(new te(e));else{let t=this.categoryIdsArray.controls.findIndex(l=>l.value===e);this.categoryIdsArray.removeAt(t)}}isCategorySelected(e){return this.categoryIdsArray.value.includes(e)}onDragOver(e){e.preventDefault(),e.stopPropagation(),this.isDragging=!0}onDragLeave(e){e.preventDefault(),e.stopPropagation(),this.isDragging=!1}onDrop(e){e.preventDefault(),e.stopPropagation(),this.isDragging=!1;let i=e.dataTransfer?.files;i&&i.length>0&&this.handleFile(i[0])}onFileSelected(e){let i=e.target;i.files&&i.files.length>0&&this.handleFile(i.files[0])}handleFile(e){if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(e.type)){this.snackBar.open("Please select a valid image file (JPEG, PNG, WebP, or GIF)","Close",{duration:4e3});return}let t=10*1024*1024;if(e.size>t){this.snackBar.open("File size must be less than 10MB","Close",{duration:4e3});return}this.selectedFile=e;let l=new FileReader;l.onload=s=>{this.imagePreview=s.target?.result},l.readAsDataURL(e)}removeFile(){this.selectedFile=null,this.imagePreview=null}canSubmit(){return this.uploadForm.valid&&!!this.selectedFile&&!this.isUploading}onSubmit(){return F(this,null,function*(){if(!this.canSubmit()||!this.selectedFile)return;this.isUploading=!0,this.uploadProgress=0;let e=new FormData;e.append("file",this.selectedFile),e.append("title",this.uploadForm.value.title),e.append("description",this.uploadForm.value.description),e.append("categoryIds",JSON.stringify(this.uploadForm.value.categoryIds)),e.append("price",this.uploadForm.value.price.toString()),this.http.post(`${R.apiUrl}/photos/upload`,e,{reportProgress:!0,observe:"events"}).subscribe({next:i=>{i.type===O.UploadProgress?this.uploadProgress=Math.round(100*i.loaded/(i.total||1)):i.type===O.Response&&(this.snackBar.open("Photo uploaded successfully!","View",{duration:5e3}).onAction().subscribe(()=>{this.router.navigate(["/admin/photos"])}),this.resetForm())},error:i=>{console.error("Upload error:",i);let t=i.error?.error?.message||"Failed to upload photo";this.snackBar.open(t,"Close",{duration:5e3}),this.isUploading=!1,this.uploadProgress=0}})})}resetForm(){this.uploadForm.reset({price:0}),this.categoryIdsArray.clear(),this.selectedFile=null,this.imagePreview=null,this.isUploading=!1,this.uploadProgress=0}cancel(){this.router.navigate(["/admin/photos"])}static \u0275fac=function(i){return new(i||r)(C(le),C(T),C(L),C(ge),C(B))};static \u0275cmp=k({type:r,selectors:[["app-photo-upload"]],decls:50,vars:17,consts:[["fileInput",""],[1,"photo-upload-container"],[1,"header"],["mat-button","",3,"click"],[1,"upload-content"],[1,"upload-card"],[1,"drop-zone",3,"dragover","dragleave","drop","click"],["class","drop-zone-content",4,"ngIf"],["class","preview-container",4,"ngIf"],["type","file","accept","image/jpeg,image/jpg,image/png,image/webp,image/gif",2,"display","none",3,"change"],[1,"upload-form",3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","title","placeholder","Enter photo title"],[4,"ngIf"],["matInput","","formControlName","description","rows","4","placeholder","Enter photo description"],[1,"form-section"],[1,"section-label"],[1,"categories-checkboxes"],[3,"checked","change",4,"ngFor","ngForOf"],["matInput","","type","number","formControlName","price","min","0","placeholder","e.g., 4999 for $49.99"],["class","upload-progress",4,"ngIf"],[1,"form-actions"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-button","","type","button",3,"click","disabled"],[1,"drop-zone-content"],[1,"upload-icon"],[1,"file-info"],[1,"preview-container"],["alt","Preview",1,"preview-image",3,"src"],["mat-icon-button","",1,"remove-button",3,"click"],[3,"change","checked"],[1,"upload-progress"],["mode","determinate",3,"value"]],template:function(i,t){if(i&1){let l=b();n(0,"div",1)(1,"div",2)(2,"h1"),a(3,"Upload Photo"),o(),n(4,"button",3),_("click",function(){return d(l),g(t.cancel())}),n(5,"mat-icon"),a(6,"arrow_back"),o(),a(7," Back to Photos "),o()(),n(8,"div",4)(9,"mat-card",5)(10,"mat-card-content")(11,"div",6),_("dragover",function(m){return d(l),g(t.onDragOver(m))})("dragleave",function(m){return d(l),g(t.onDragLeave(m))})("drop",function(m){return d(l),g(t.onDrop(m))})("click",function(){d(l);let m=I(15);return g(m.click())}),f(12,Pe,9,0,"div",7)(13,Me,5,1,"div",8),n(14,"input",9,0),_("change",function(m){return d(l),g(t.onFileSelected(m))}),o()(),n(16,"form",10),_("ngSubmit",function(){return d(l),g(t.onSubmit())}),n(17,"mat-form-field",11)(18,"mat-label"),a(19,"Title"),o(),P(20,"input",12),f(21,xe,2,0,"mat-error",13)(22,be,2,0,"mat-error",13),o(),n(23,"mat-form-field",11)(24,"mat-label"),a(25,"Description"),o(),P(26,"textarea",14),f(27,ve,2,0,"mat-error",13)(28,Oe,2,0,"mat-error",13),o(),n(29,"div",15)(30,"label",16),a(31,"Categories (select at least one) *"),o(),n(32,"div",17),f(33,ye,2,2,"mat-checkbox",18),o(),f(34,we,2,0,"mat-error",13),o(),n(35,"mat-form-field",11)(36,"mat-label"),a(37,"Base Price (cents)"),o(),P(38,"input",19),n(39,"mat-hint"),a(40,"Enter price in cents (e.g., 4999 = $49.99)"),o(),f(41,Fe,2,0,"mat-error",13),o(),f(42,Se,4,2,"div",20),n(43,"div",21)(44,"button",22)(45,"mat-icon"),a(46,"cloud_upload"),o(),a(47," Upload Photo "),o(),n(48,"button",23),_("click",function(){return d(l),g(t.resetForm())}),a(49," Reset "),o()()()()()()()}if(i&2){let l,s,m,y,x,w;p(11),E("dragging",t.isDragging)("has-file",t.selectedFile),p(),c("ngIf",!t.imagePreview),p(),c("ngIf",t.imagePreview),p(3),c("formGroup",t.uploadForm),p(5),c("ngIf",(l=t.uploadForm.get("title"))==null?null:l.hasError("required")),p(),c("ngIf",(s=t.uploadForm.get("title"))==null?null:s.hasError("minlength")),p(5),c("ngIf",(m=t.uploadForm.get("description"))==null?null:m.hasError("required")),p(),c("ngIf",(y=t.uploadForm.get("description"))==null?null:y.hasError("minlength")),p(5),c("ngForOf",t.categories),p(),c("ngIf",((x=t.uploadForm.get("categoryIds"))==null?null:x.hasError("required"))&&((x=t.uploadForm.get("categoryIds"))==null?null:x.touched)),p(7),c("ngIf",(w=t.uploadForm.get("price"))==null?null:w.hasError("min")),p(),c("ngIf",t.isUploading),p(2),c("disabled",!t.canSubmit()),p(4),c("disabled",t.isUploading)}},dependencies:[V,z,U,D,pe,oe,Y,ne,Z,ee,ae,re,ie,J,$,H,ce,X,W,Q,K,de,me,se,j,A,N,q,G,_e,fe,Ce,he,ue],styles:[".photo-upload-container[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:24px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-family:Prata,serif;font-size:32px;color:#616e76;margin:0}.header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-family:Barlow,sans-serif;font-weight:600}.header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.upload-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:24px}.drop-zone[_ngcontent-%COMP%]{border:3px dashed #ddd;border-radius:12px;padding:60px 20px;text-align:center;cursor:pointer;transition:all .3s ease;margin-bottom:32px;background:#fafafa;min-height:300px;display:flex;align-items:center;justify-content:center}.drop-zone[_ngcontent-%COMP%]:hover{border-color:#e2bf55;background:#fffef8}.drop-zone.dragging[_ngcontent-%COMP%]{border-color:#e2bf55;background:#fffef8;border-style:solid}.drop-zone.has-file[_ngcontent-%COMP%]{padding:20px;min-height:auto}.drop-zone[_ngcontent-%COMP%]   .drop-zone-content[_ngcontent-%COMP%]   .upload-icon[_ngcontent-%COMP%]{font-size:80px;width:80px;height:80px;color:#999;margin-bottom:16px}.drop-zone[_ngcontent-%COMP%]   .drop-zone-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-family:Prata,serif;font-size:24px;color:#616e76;margin:0 0 8px}.drop-zone[_ngcontent-%COMP%]   .drop-zone-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:Barlow,sans-serif;font-size:16px;color:#999;margin:4px 0}.drop-zone[_ngcontent-%COMP%]   .drop-zone-content[_ngcontent-%COMP%]   p.file-info[_ngcontent-%COMP%]{font-size:14px;color:#bbb;margin-top:16px}.drop-zone[_ngcontent-%COMP%]   .preview-container[_ngcontent-%COMP%]{position:relative;max-width:100%}.drop-zone[_ngcontent-%COMP%]   .preview-container[_ngcontent-%COMP%]   .preview-image[_ngcontent-%COMP%]{max-width:100%;max-height:400px;border-radius:8px;box-shadow:0 4px 8px #0000001a}.drop-zone[_ngcontent-%COMP%]   .preview-container[_ngcontent-%COMP%]   .remove-button[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;background:#0009;color:#fff}.drop-zone[_ngcontent-%COMP%]   .preview-container[_ngcontent-%COMP%]   .remove-button[_ngcontent-%COMP%]:hover{background:#000c}.upload-form[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}.upload-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{font-family:Barlow,sans-serif}.upload-form[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%]{margin:16px 0}.upload-form[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%]   .section-label[_ngcontent-%COMP%]{display:block;font-family:Barlow,sans-serif;font-size:16px;font-weight:600;color:#616e76;margin-bottom:12px}.upload-form[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%]   .categories-checkboxes[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px;padding:16px;border:1px solid #e0e0e0;border-radius:4px;background:#fafafa}.upload-form[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%]   .categories-checkboxes[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{font-family:Barlow,sans-serif}.upload-form[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%]   mat-error[_ngcontent-%COMP%]{font-size:12px;color:#f44336;margin-top:4px;display:block}.upload-form[_ngcontent-%COMP%]   .upload-progress[_ngcontent-%COMP%]{margin:24px 0}.upload-form[_ngcontent-%COMP%]   .upload-progress[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:Barlow,sans-serif;font-weight:600;color:#616e76;margin-bottom:8px}.upload-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]{display:flex;gap:12px;margin-top:24px}.upload-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-family:Barlow,sans-serif;font-weight:800}.upload-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.upload-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   button[color=primary][_ngcontent-%COMP%]{background-color:#e2bf55!important;color:#616e76!important}@media(max-width:768px){.photo-upload-container[_ngcontent-%COMP%]{padding:16px}.header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:16px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px}.drop-zone[_ngcontent-%COMP%]{padding:40px 20px;min-height:250px}.drop-zone[_ngcontent-%COMP%]   .drop-zone-content[_ngcontent-%COMP%]   .upload-icon[_ngcontent-%COMP%]{font-size:60px;width:60px;height:60px}.drop-zone[_ngcontent-%COMP%]   .drop-zone-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:20px}}"]})}return r})();export{nt as PhotoUploadComponent};
