import{a}from"./chunk-5GM4WQFN.js";import{N as o,Q as c,cc as l,fc as d,x as s}from"./chunk-Z7QZQF3E.js";var h=(()=>{class n{router;GA4_ENDPOINT="https://www.google-analytics.com/mp/collect";measurementId=a.ga4MeasurementId;apiSecret=a.ga4ApiSecret;clientId;sessionId;sessionStartTime;constructor(e){this.router=e,this.clientId=this.getOrCreateClientId(),this.sessionId=this.generateSessionId(),this.sessionStartTime=Date.now(),this.initializeRouteTracking()}initializeRouteTracking(){this.router.events.pipe(s(e=>e instanceof l)).subscribe(e=>{this.trackPageView(e.urlAfterRedirects)})}trackPageView(e){let t={name:"page_view",params:{page_location:window.location.href,page_path:e,page_title:document.title,engagement_time_msec:Date.now()-this.sessionStartTime}};this.sendEvent(t)}trackEvent(e,t){let i={name:e,params:t||{}};this.sendEvent(i)}trackAddToCart(e,t,i){this.trackEvent("add_to_cart",{currency:"USD",value:i,items:[{item_id:e.toString(),item_name:t,price:i}]})}trackPurchase(e,t,i){this.trackEvent("purchase",{transaction_id:e,currency:"USD",value:t,items:i})}sendEvent(e){if(!a.production&&!a.enableAnalytics){console.log("[Analytics] Event (not sent in dev):",e);return}let t={client_id:this.clientId,events:[e],user_properties:{session_id:{value:this.sessionId}}},i=`${this.GA4_ENDPOINT}?measurement_id=${this.measurementId}&api_secret=${this.apiSecret}`;if(navigator.sendBeacon){let r=new Blob([JSON.stringify(t)],{type:"application/json"});navigator.sendBeacon(i,r)}else fetch(i,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"},keepalive:!0}).catch(r=>{console.error("[Analytics] Failed to send event:",r)});console.log("[Analytics] Event sent:",e.name,e.params)}getOrCreateClientId(){let e=localStorage.getItem("ga_client_id");return e||(e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let i=Math.random()*16|0;return(t==="x"?i:i&3|8).toString(16)}),localStorage.setItem("ga_client_id",e)),e}generateSessionId(){return Date.now().toString()}static \u0275fac=function(t){return new(t||n)(c(d))};static \u0275prov=o({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();export{h as a};
